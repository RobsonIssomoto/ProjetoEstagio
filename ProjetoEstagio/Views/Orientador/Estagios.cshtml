@model List<ProjetoEstagio.Models.TermoCompromissoModel>
@using ProjetoEstagio.Models.Enums

@{
    ViewData["Title"] = "Todos os Estágios";
    Layout = "_LayoutAdmin";
}

<h3 class="fw-bold">Painel Geral de Estágios</h3>
<p class="text-muted">Visualize o histórico de todos os processos e altere orientadores de estágios em andamento.</p>


<div class="card shadow-sm">
    <div class="card-header bg-white p-4">
        <h5 class="mb-0 fw-bold">Histórico Completo de Termos</h5>
        <p class="text-muted mb-0 small">Lista de todos os estágios, incluindo pendentes, em andamento e finalizados.</p>
    </div>
    <div class="table-responsive p-3">
        <table id="estagiosTable" class="table table-striped table-bordered table-hover align-middle mb-0" style="width:100%">
            <thead class="table-light">
                <tr>
                    <th>Estudante</th>
                    <th>Empresa</th>
                    <th>Orientador (Instituição)</th>
                    <th>Status</th>
                    <th>Data Solicitação</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var termo in Model)
                {
                    var solicitacao = termo.SolicitacaoEstagio;

                    <tr>
                        <td>@solicitacao.Estagiario.Nome</td>
                        <td>@solicitacao.Empresa.Nome</td>

                        <td>
                            @if (termo.Orientador != null)
                            {
                                @termo.Orientador.Nome
                            }
                            else
                            {
                                <span class="text-muted fst-italic">Aguardando...</span>
                            }
                        </td>

                        <td>
                            @if (solicitacao.Status == Status.Pendente)
                            {
                                <span class="badge text-bg-warning">Pendente (Empresa)</span>
                            }
                            else if (solicitacao.Status == Status.Aprovado)
                            {
                                <span class="badge text-bg-info">Aprovado (Aguard. Orientador)</span>
                            }
                            else if (solicitacao.Status == Status.EmAndamento)
                            {
                                <span class="badge text-bg-primary">Em Andamento</span>
                            }
                            else if (solicitacao.Status == Status.Rejeitado)
                            {
                                <span class="badge text-bg-danger">Rejeitado</span>
                            }
                            else
                            {
                                <span class="badge text-bg-secondary">@solicitacao.Status</span>
                            }
                        </td>

                        <td>@solicitacao.DataSubmissao.ToString("dd/MM/yyyy")</td>

                        <td class"text-center">
                            @* Botão de Download (seu código existente) *@
                            @if (!string.IsNullOrEmpty(termo.CaminhoArquivo))
                            {
                                <a class="btn btn-success btn-sm"
                                   asp-controller="Orientador"
                                   asp-action="DownloadTermo"
                                   asp-route-termoId="@termo.Id"
                                   title="Baixar Termo Gerado">
                                    <i class="fa-solid fa-file-pdf"></i>
                                </a>
                            }

                            @* (Só mostra se o estágio já tiver um orientador) *@
                            @if (termo.OrientadorId != null)
                            {
                                <button class="btn btn-warning btn-sm btn-alterar-orientador"
                                        title="Alterar Orientador"
                                        data-id="@termo.Id">
                                    <i class="fa-solid fa-pencil"></i>
                                </button>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="alterarOrientadorModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Alterar Orientador</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body"></div>
        </div>
    </div>
</div>

