@model List<ProjetoEstagio.Models.TermoCompromissoModel>
@using ProjetoEstagio.Models.Enums // Para usar o Status.EmAndamento, etc.

@{
    ViewData["Title"] = "Todos os Estágios";
    Layout = "_LayoutAdmin";
}

<h3 class="fw-bold">Painel de Estágios</h3>
<p class="text-muted">Visualize o histórico e o status de todas as solicitações de estágio.</p>

<div class="card shadow-sm">
    <div class="card-header bg-white p-4">
        <h5 class="mb-0 fw-bold">Todos os Processos</h5>
        <p class="text-muted mb-0 small">Lista de todos os estágios, incluindo pendentes, em andamento, rejeitados e concluídos.</p>
    </div>

    <div class="table-responsive p-3">
        <table id="estagiosTable" class="table table-striped table-bordered table-hover align-middle mb-0" style="width:100%">
            <thead class="table-light">
                <tr>
                    <th>Estudante</th>
                    <th>Empresa</th>
                    <th>Orientador (Instituição)</th>
                    <th>Status</th>
                    <th>Data Solicitação</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var termo in Model)
                {
                    var solicitacao = termo.SolicitacaoEstagio; // Atalho

                    <tr>
                        <td>@solicitacao.Estagiario.Nome</td>
                        <td>@solicitacao.Empresa.Nome</td>

                        <td>
                            @if (termo.Orientador != null)
                            {
                                @termo.Orientador.Nome
                            }
                            else
                            {
                                <span class="text-muted fst-italic">Aguardando...</span>
                            }
                        </td>

                        <td>
                            @if (solicitacao.Status == Status.Pendente)
                            {
                                <span class="badge text-bg-warning">Pendente (Empresa)</span>
                            }
                            else if (solicitacao.Status == Status.Aprovado)
                            {
                                <span class="badge text-bg-info">Aprovado (Aguard. Orientador)</span>
                            }
                            else if (solicitacao.Status == Status.EmAndamento)
                            {
                                <span class="badge text-bg-primary">Em Andamento</span>
                            }
                            else if (solicitacao.Status == Status.Rejeitado)
                            {
                                <span class="badge text-bg-danger">Rejeitado</span>
                            }
                            else
                            {
                                <span class="badge text-bg-secondary">@solicitacao.Status</span>
                            }
                        </td>

                        <td>@solicitacao.DataSubmissao.ToString("dd/MM/yyyy")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Ativa o DataTables (usando sua função global do site.js)
            getDataTable('#estagiosTable');
        });
    </script>
}