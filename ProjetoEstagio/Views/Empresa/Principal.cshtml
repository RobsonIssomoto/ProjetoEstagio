@model ProjetoEstagio.Models.ViewModels.DashboardEmpresaViewModel
@using ProjetoEstagio.Models.Enums

@{
    ViewData["Title"] = "Company Dashboard";
    Layout = "_LayoutEmpresa";
}

<style>
    /* Estilo para a lista de pedidos, baseado no seu print */
    .request-list-item {
        display: grid;
        /* Nome, Curso, Status, Data, Ações */
        grid-template-columns: 2fr 2fr 1fr 1.5fr 1.5fr;
        align-items: center;
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid #dee2e6;
        gap: 1rem;
    }

    .request-list-header {
        font-size: 0.85rem;
        font-weight: 600;
        color: #6c757d;
        padding: 0 1.5rem;
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }

    .request-list-item:last-child {
        border-bottom: 0;
    }

    /* Responsivo (simplificado) */
    @@media (max-width: 992px) {
        .request-list-header {
            display: none;
        }

        .request-list-item {
            grid-template-columns: 1fr; /* Tudo em uma coluna */
            gap: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
        }
    }
</style>

<h3 class="fw-bold">Dashboard</h3>
<p class="text-muted">Gerencie as solicitações de estágio e estágios ativos.</p>

@if (Model.PedidosPendentesCount > 0)
{
    <div class="alert alert-warning d-flex align-items-center" role="alert">
        <i class="fa-solid fa-triangle-exclamation me-2"></i>
        <div>
            <strong>@Model.PedidosPendentesCount solicitações aguardando análise</strong>
        </div>
    </div>
}

<div class="card shadow-sm mb-4">
    <div class="card-body p-4">
        <form asp-action="Principal" method="get">
            <div class="row g-3 align-items-center">
                <div class="col-12 col-lg-4">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa-solid fa-search"></i></span>
                        <input type="text" name="filtroNome" class="form-control" placeholder="Buscar por nome...">
                    </div>
                </div>
                <div class="col-12 col-lg-3">
                    <select name="filtroStatus" class="form-select">
                        <option value="">Todos os Status</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Aprovado">Aprovado</option>
                    </select>
                </div>
                <div class="col-12 col-lg-3">
                    <select name="filtroCurso" class="form-select">
                        <option value="">Todos os Cursos</option>
                        <option value="ADS">Análise e Desenvolvimento de Sistemas</option>
                        <option value="GTI">Gestão da Tecnologia da Informação</option>
                    </select>
                </div>
                <div class="col-12 col-lg-2">
                    <button type="submit" class="btn btn-danger w-100">Filtrar</button>
                </div>
            </div>
        </form>
    </div>
</div>


@* ... (cabeçalho da View, @model, @using, etc.) ... *@

<div class="card shadow-sm">
    <div class="card-header bg-white p-4">
        <h5 class="mb-0 fw-bold">Solicitações de Estágio</h5>
        <p class="text-muted mb-0 small">Analise e gerencie as solicitações dos estudantes.</p>
    </div>

    <!--
      SUBSTITUÍDO: O card-body p-0 foi removido.
      PADRÃO: Usando table-responsive para melhor visualização
    -->
    <div class="table-responsive p-3">
        <!-- PADRÃO: Aplicando as classes do Index.cshtml (table, table-striped, etc.) -->
        <table id="solicitacoesTable" class="table table-striped table-bordered table-hover align-middle mb-0" style="width:100%">

            <!-- PADRÃO: Usando <thead> como no Index.cshtml -->
            <thead class="table-light">
                <tr>
                    <th>Nome do Estudante</th>
                    <th>Curso</th>
                    <th>Status</th>
                    <th>Data de Envio</th>
                    <th class="text-end">Ações</th>
                </tr>
            </thead>

            <tbody>
                @if (Model.PedidosDeEstagio != null && Model.PedidosDeEstagio.Any())
                {
                    // PADRÃO: Loop de <tr> (linhas da tabela)
                    foreach (var pedido in Model.PedidosDeEstagio)
                    {
                        <tr>
                            <td>@pedido.Estagiario.Nome</td>

                            <td>@pedido.Estagiario.NomeCurso</td>

                            <td>
                                @if (pedido.Status == Status.Pendente)
                                {
                                    <span class="badge text-bg-warning">Pendente</span>
                                }
                                else if (pedido.Status == Status.Aprovado)
                                {
                                    <span class="badge text-bg-success">Aprovado</span>
                                }
                                else if (pedido.Status == Status.Aguardando)
                                {
                                    <span class="badge text-bg-info">Aguardando Cadastro</span>
                                }
                                else if (pedido.Status == Status.EmAndamento)
                                {
                                    <span class="badge text-bg-primary">Em Andamento</span>
                                }
                                else if (pedido.Status == Status.Rejeitado)
                                {
                                    <span class="badge text-bg-danger">Rejeitado</span>
                                }
                                else
                                {
                                    <span class="badge text-bg-secondary">@pedido.Status</span>
                                }
                            </td>

                            <td>@pedido.DataSubmissao.ToString("dd/MM/yyyy")</td>

                            <td class="text-end">

                                @if (pedido.Status == Status.Pendente || pedido.Status == Status.EmAndamento)
                                {
                                    <a asp-action="PreencherTermo" asp-route-solicitacaoId="@pedido.Id"
                                       class="btn btn-primary btn-sm" title="Analisar Solicitação">
                                        <i class="fa-solid fa-pen-to-square me-1"></i> Analisar
                                    </a>
                                }
                                else if (pedido.Status == Status.Aprovado)
                                {
                                    <a asp-action="PreencherTermo" asp-route-solicitacaoId="@pedido.Id"
                                       class="btn btn-outline-secondary btn-sm" title="Ver Termo">
                                        <i class="fa-solid fa-eye"></i> Ver Termo
                                    </a>
                                }
                                else if (pedido.Status == Status.Rejeitado)
                                {
                                    <a asp-action="PreencherTermo" asp-route-solicitacaoId="@pedido.Id"
                                       class="btn btn-outline-danger btn-sm" title="Ver Motivo">
                                        <i class="fa-solid fa-magnifying-glass"></i> Ver Motivo
                                    </a>
                                }
                            </td>
                        </tr>
                    }
                }
                @* O 'else' foi removido corretamente, o tbody vazio é o ideal *@
            </tbody>
        </table>
    </div>
</div>

@* <div class="card shadow-sm"> *@
@*     <div class="card-header bg-white p-4"> *@
@*         <h5 class="mb-0 fw-bold">Solicitações de Estágio</h5> *@
@*         <p class="text-muted mb-0 small">Analise e gerencie as solicitações dos estudantes.</p> *@
@*     </div> *@

@*     <div class="card-body p-0"> *@

@*         <div class="request-list-header request-list-item d-none d-lg-grid"> *@
@*             <div>Nome do Estudante</div> *@
@*             <div>Curso</div> *@
@*             <div>Status</div> *@
@*             <div>Data de Envio</div> *@
@*             <div class_="text-end">Ações</div> *@
@*         </div> *@

@*         @if (Model.PedidosDeEstagio != null && Model.PedidosDeEstagio.Any()) *@
@*         { *@
@*             foreach (var pedido in Model.PedidosDeEstagio) *@
@*             { *@
@*                 <div class="request-list-item"> *@

@*                     <div> *@
@*                         <strong class="fw-bold d-lg-none">Estudante: </strong> *@
@*                         @pedido.Estagiario.Nome *@
@*                     </div> *@

@*                     <div> *@
@*                         <strong class="d-lg-none">Curso: </strong> *@
@*                         @pedido.Estagiario.NomeCurso *@
@*                     </div> *@

@*                     <div> *@
@*                         <strong class="d-lg-none">Status: </strong> *@
@*                         @if (pedido.Status == Status.Pendente) *@
@*                         { *@
@*                             <span class="badge text-bg-warning">Pendente</span> *@
@*                         } *@
@*                         else if (pedido.Status == Status.Aprovado) *@
@*                         { *@
@*                             <span class="badge text-bg-success">Aprovado</span> *@
@*                         } *@
@*                         else if (pedido.Status == Status.Aguardando) *@
@*                         { *@
@*                             <span class="badge text-bg-info">Aguardando Cadastro</span> *@
@*                         } *@
@*                         else *@
@*                         { *@
@*                             <span class="badge text-bg-secondary">@pedido.Status</span> *@
@*                         } *@
@*                     </div> *@

@*                     <div> *@
@*                         <strong class="d-lg-none">Envio: </strong> *@
@*                         @pedido.DataSubmissao.ToString("dd/MM/yyyy") *@
@*                     </div> *@

@*                     <div class="text-lg-end mt-2 mt-lg-0"> *@
@*                         <a asp-action="Detalhes" asp-route-id="@pedido.Id" class="btn btn-outline-secondary btn-sm"> *@
@*                             <i class="fa-solid fa-eye me-1"></i> Detalhes *@
@*                         </a> *@

@*                         @if (pedido.Status == Status.Pendente) *@
@*                         { *@
@*                             <form asp-action="Aprovar" method="post" class="d-inline ms-1"> *@
@*                                 <input type="hidden" name="solicitacaoId" value="@pedido.Id" /> *@
@*                                 <button type="submit" class="btn btn-success btn-sm"> *@
@*                                     <i class="fa-solid fa-check me-1"></i> Aprovar *@
@*                                 </button> *@
@*                                 @Html.AntiForgeryToken() *@
@*                             </form> *@
@*                         } *@
@*                     </div> *@
@*                 </div> *@
@*             } *@
@*         } *@
@*         else *@
@*         { *@
@*             <div class="p-4 text-center text-muted"> *@
@*                 <p class="mb-0">Não há requisições de estágio no momento.</p> *@
@*             </div> *@
@*         } *@
@*     </div> *@
@* </div> *@